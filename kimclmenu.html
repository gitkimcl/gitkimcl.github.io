<div id="k_commandslot"></div>
<nav id="k_menu">
	<div id="k_menublur">
		<div id="k_menulogo" onclick="k_onclick(0);" data-id="0"></div>
	</div>
	<div onclick="k_onclick(1);" data-id="1" title="홈으로" id="k_btn1" class="k_menubtn" style="--xtrans: 0; --ytrans: -0.55em; background-color: oklab(0.7 0.2 0.2 / 60%);">
		<svg role="img" class="k_menuicon" viewBox="0 0 350 350">
			<circle class="k_menustroke" cx="175" cy="175" r="90"/>
		</svg>
	</div>
	<div onclick="k_onclick(2);" data-id="2" title="돌아가기" id="k_btn2" class="k_menubtn" style="--xtrans: 0.55em; --ytrans: -0.55em; background-color: oklab(0.8 0 0.2 / 60%);">
		<svg role="img" class="k_menuicon" viewBox="0 0 350 350">
			<polygon class="k_menustroke" points="90,175 250,267.4 250,82.6"/>
		</svg>
	</div>
	<div onclick="k_onclick(3);" data-id="3" title="올라가기" id="k_btn3" class="k_menubtn" style="--xtrans: 0.55em; --ytrans: 0; background-color: oklab(0.7 -0.2 0.2 / 60%);">
		<svg role="img" class="k_menuicon" viewBox="0 0 350 350">
			<polygon class="k_menustroke" points="175,90 82.6,250 267.4,250"/>
		</svg>
	</div>
	<div onclick="k_onclick(4);" data-id="4" title="숨기기" id="k_btn4" class="k_menubtn" style="--xtrans: 0.55em; --ytrans: 0.55em; background-color: oklab(0.7 -0.2 -0.2 / 60%);">
		<svg role="img" class="k_menuicon" viewBox="0 0 350 350">
			<polygon class="k_menustroke" points="175,260 267.4,100 82.6,100"/>
		</svg>
	</div>
	<div onclick="k_onclick(5);" data-id="5" title="?" id="k_btn5" class="k_menubtn" style="--xtrans: 0; --ytrans: 0.55em; background-color: oklab(0.7 0.2 -0.2 / 60%);">
		<svg role="img" class="k_menuicon" viewBox="0 0 350 350">
			<polygon class="k_menustroke" points="260,175 100,82.6 100,267.4"/>
		</svg>
	</div>
</nav>
<style>
	#k_menu, #k_commands {
		font-size: var(--kimclweb-1rem, 8.8rem);
		z-index: 3;
	}

	#k_menu {
		position: fixed;
		left: 0.05em;
		top: 50%;
		transform: translate(0, -50%);
		transition: opacity 0.2s, display 0.2s;
		transition-behavior: allow-discrete;
	}

	#k_menu * {
		-webkit-user-select: none;
		-webkit-user-drag: none;
		user-select: none;
	}
	
	@media screen and (max-width: 480px), screen and (max-width: 30.8rem) {
		#k_menu, #k_commands {
			font-size: var(--kimclweb-1rem, calc(100vw / 3.5));
		}
	}
	
	#k_menublur {
		width: 0.5em;
		height: 0.5em;
		border-radius: 0.1em;
		overflow: hidden;
		transition: backdrop-filter 0.2s;
	}
	
	#k_menulogo {
		width: 100%;
		height: 100%;
		background: url('/img/test_img.png');
		background-size: cover;
		image-rendering: pixelated;
		opacity: 0.3;
		box-shadow: inset 0 0 0.1em rgb(250 250 250);
		transition: opacity 0.2s, box-shadow 0.2s;
		cursor: pointer;
	}
	
	@media screen and (prefers-color-scheme: dark) {
		#k_menulogo {
			box-shadow: inset 0 0 0.1em rgb(35 35 35);
		}
	}
	
	.k_active #k_menublur {
		backdrop-filter: blur(0.025em);
	}
	
	.k_active #k_menulogo {
		opacity: 0.75;
	}

	#k_commands + .k_active #k_menulogo {
		opacity: 0.9;
	}
	
	#k_menulogo#k_menulogo:hover {
		opacity: 0.9;
		box-shadow: inset 0 0 0.1em transparent;
	}
	
	.k_menubtn {
		position: absolute;
		top: 0.025em;
		left: 0.025em;
		transition: scale 0.2s, opacity 0.2s, visibility 0.2s;
		transition-behavior: allow-discrete;
		transform: translate(var(--xtrans), var(--ytrans));
		scale: 0.5;
		opacity: 0;
		visibility: hidden;
		width: 0.45em;
		height: 0.45em;
		border-radius: 50%;
		background-origin: border-box;
		border: 0.03em solid rgb(0 0 0 / 30%);
		box-sizing: border-box;
		backdrop-filter: blur(0.025em);
		cursor: pointer;
		touch-action: manipulation;
	}
	
	.k_active .k_menubtn {
		scale: 1;
		opacity: 1;
		visibility: visible;
	}
	
	.k_menuicon {
		position: absolute;
		inset: 0;
		shape-rendering: geometricPrecision;
	}
	
	.k_menustroke {
		stroke-linecap: round;
		stroke-linejoin: round;
		fill: transparent;
		stroke: rgb(0 0 0 / 30%);
		stroke-width: 0.03em;
		vector-effect: non-scaling-stroke;
	}

	#k_commands {
		position: fixed;
		top: 50%;
		left: 0;
		width: 100%;
		padding-inline: max(5vw, calc(50% - 2.275em));
		box-sizing: border-box;
		text-align: center;
		z-index: 4;
		transform: translate(0,-50%);
		line-height: 0px;
		pointer-events: none;
		transition: opacity 0.5s;
	}

	#k_commands.k_cmdfail, #k_commands.k_cmdsuccess {
		opacity: 0;
	}

	.k_cmdicon {
		width: 0.39em;
		height: 0.39em;
		margin: -0.05em;
		shape-rendering: geometricPrecision;
	}

	.k_cmdicon .k_menustroke {
		transition: stroke 0.2s, fill 0.2s;
		stroke: var(--stroke);
	}

	.k_cmdsuccess .k_cmdicon .k_menustroke {
		stroke: oklab(from var(--stroke) l a b / 100%);
		fill: oklab(from var(--stroke) l a b / 100%);
	}

	.k_cmdfail .k_cmdicon .k_menustroke {
		stroke: oklab(from var(--stroke) 0 a b / alpha);
	}
</style>
<script id="script">
	let sr = document.querySelector("kimcl-menu").shadowRoot;

	for (let i=0; i<=5; i++) {
		sr.querySelector(`[data-id="${i}"]`).onclick = (_) => {
			k_onclick(i);
		}
	}

	function k_onclick(id) {
		if (k_cinput && 1<=id && id<=4) {
			function k_push(n) {
				k_command.push(n);
				sr.getElementById("k_commands").insertAdjacentHTML("beforeend",k_cmdicns[n]);
			}
			if (id==2) {
				let a = k_command.pop();
				sr.querySelector(".k_cmdicon:last-child").remove();
				switch (a) {
					case 1: k_push(6); break;
					case 2: k_push(5); break;
					case 3: k_push(7); break;
					case 4: k_push(8); break;
					case 5: k_push(9); break;
					case 6: case 7: case 8: k_push(2); break;
					case 9: k_push(0); break;
					case 0: break;
				}
				return;
			}
			k_push(id);
			return;
		}
		let e;
		switch (id) {
			case 0:
				e=sr.getElementById('k_menu');
				e.getAttribute('class')?e.removeAttribute('class'):e.setAttribute('class','k_active');
				break;
			case 1:
				window.location.pathname='';
				break;
			case 2:
				h=window.location.pathname;
				if (!(/\/$/.test(h)) && !(/\/index.html$/.test(h))) {
					window.location.href='.';
				} else if (h.includes('/things')) {
					window.location.pathname=h.replace(/\/things\/(?!things\/)(?!.*\/things\/).*/,'/');
				} else {
					window.location.href='..';
				}
				break;
			case 3:
				window.scrollBy(0,-window.scrollY);
				e=document.getElementById('wrapper');
				e && (e.scrollTop=0);
				break;
			case 4:
				sr.getElementById('k_menu').setAttribute('style','opacity: 0; display: none;');
				break;
			case 5:
				k_cinput?k_endcmdinput():k_startcmdinput();
		}
	}

	var k_cinput = false;
	var k_command = [];
	var k_cmdicns = ['<br class="k_cmdicon">',
		'<svg role="img" class="k_cmdicon" viewBox="0 0 350 350" style="--stroke: oklab(0.7 0.2 0.2 / 60%);"><circle class="k_menustroke" cx="175" cy="175" r="90"/></svg>',
		'<svg role="img" class="k_cmdicon" viewBox="0 0 350 350" style="--stroke: oklab(0.8 0 0.2 / 60%);"><polygon class="k_menustroke" points="90,175 250,267.4 250,82.6"/></svg>',
		'<svg role="img" class="k_cmdicon" viewBox="0 0 350 350" style="--stroke: oklab(0.7 -0.2 0.2 / 60%);"><polygon class="k_menustroke" points="175,90 82.6,250 267.4,250"/></svg>',
		'<svg role="img" class="k_cmdicon" viewBox="0 0 350 350" style="--stroke: oklab(0.7 -0.2 -0.2 / 60%);"><polygon class="k_menustroke" points="175,260 267.4,100 82.6,100"/></svg>',
		'<svg role="img" class="k_cmdicon" viewBox="0 0 350 350" style="--stroke: oklab(0.7 0.2 -0.2 / 60%);"><polygon class="k_menustroke" points="260,175 100,82.6 100,267.4"/></svg>',
		'<svg role="img" class="k_cmdicon" viewBox="0 0 350 350" style="--stroke: oklab(0.8 -0.2 0 / 60%);"><polygon class="k_menustroke" points="95,95 255,95 255,255 95,255"/></svg>',
		'<svg role="img" class="k_cmdicon" viewBox="0 0 350 350" style="--stroke: oklab(0.6 0 -0.2 / 60%);"><line class="k_menustroke" x1="95" y1="175" x2="255" y2="175"/><line class="k_menustroke" x1="175" y1="95" x2="175" y2="255"/></svg>',
		'<svg role="img" class="k_cmdicon" viewBox="0 0 350 350" style="--stroke: oklab(0.7 0.2 0 / 60%);"><line class="k_menustroke" x1="95" y1="95" x2="255" y2="255"/><line class="k_menustroke" x1="95" y1="255" x2="255" y2="95"/></svg>',
		'<svg role="img" class="k_cmdicon" viewBox="0 0 350 350" style="--stroke: oklab(0.8 0 0 / 60%);"><polygon class="k_menustroke" points="175,75 275,175 175,275 75,175"/></svg>'];

	function k_startcmdinput() {
		k_cinput = true;
		sr.getElementById("k_commandslot").id = "k_commands";
		sr.getElementById("k_commands").insertAdjacentHTML("beforeend",k_cmdicns[5]);
		k_command = [5];
	}

	function k_endcmdinput() {
		sr.getElementById('k_menu').setAttribute('style','opacity: 0; display: none;');
		let success = k_exec();
		sr.getElementById("k_commands").setAttribute("class",success?"k_cmdsuccess":"k_cmdfail");
		return;
	}

	function k_exec() {
		let cmdstr = k_command.join("").replace(/^0+/,"").replace(/0+$/,"");
		console.log(cmdstr);
		let c;
		switch (cmdstr) {
			// type 0
			case "":
				window.close();
				window.location.href = "about:blank"; // close가 안 될 때가 있더라고
				setTimeout(()=>{  }, 200);
				return true;
			case "9":
				setTimeout(()=>{ window.location.href = "about:blank"; }, 200);
				return true;
			case "5":
				setTimeout(()=>{ window.location.reload(); }, 200);
				return true;
			
			// type 1
			case "51":
				setTimeout(()=>{ window.location.pathname=''; }, 200);
				return true;
			case "52":
				setTimeout(()=>{ h=window.location.pathname; (/\/$/.test(h)||/\/index.html$/.test(h))?(h.includes('/things/')?window.location.pathname=h.replace(/\/things\/(?!things\/)(?!.*\/things\/).*/,'/'):window.location.href='..'):window.location.href='.'; }, 200);
				return true;
			case "53":
				setTimeout(()=>{ window.scrollBy(0,-window.scrollY); a=document.getElementById('wrapper'); if (a) a.scrollTop=0; }, 200);
				return true;
			case "54":
				// duh
				return true;
			case "55":
				for (let i=0; i<223; i++) sr.getElementById("k_commands").insertAdjacentHTML("beforeend",k_cmdicns[5]);
				return true;
			case "56":
				window.open('/');
				return true;
			case "577":
			window.open(window.location.href);
			case "57":
				window.open(window.location.href);
				return true;
			case "58":
				c = confirm("localStorage와 sessionStorage가 지워집니다");
				if (!c) return false;
				localStorage.clear();
				sessionStorage.clear();
				return true;
			case "59":
				window.open();
			
			// type 2
			
			// type 3

			// type 4
			case "2506369948599423065555755558011115":
				c = confirm("->");
				if (!c) return false;
				c = confirm(",");
				if (c) return false;
				setTimeout(()=>{ window.location.pathname='/ecyce/'; }, 1500);
				return true;
			case "25099908015":
				setTimeout(()=>{ window.location.pathname='/404.html'; }, 200);
				return true;

			// default
			default:
				return false;
		}
		return false; // ?
	}
</script>